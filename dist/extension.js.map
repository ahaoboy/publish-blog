{"version":3,"sources":["axios/index.js","platform/oschina/index.js","platform/index.js","extension.js"],"names":["axios","interceptors","request","use","config","method","data","qs","stringify","error","Promise","reject","response","console","log","status","fs","require","$","yaml","re","getFrontMatter","content","s","exec","obj","safeLoad","setFrontMatter","fm","dump","replace","cookie","vscode","workspace","getConfiguration","get","mainPage","headers","accept","referrer","publish","path","info","getInfo","url","CONTENT","readFileSync","frontMatter","catalogName","tag","catalog","addCatalog","draft","id","user_code","userCode","title","content_type","classification","type","origin_url","privacy","deny_comment","as_top","downloadImg","isRecommend","resp","post","result","blogUrl","oschina","writeFileSync","html","dom","load","classificationDom","toArray","reduce","pre","now","text","attribs","value","catalogDom","userCodeDom","dataUserIdDom","dataUserId","name","space","publishAll","activate","context","disposable","commands","registerCommand","fsPath","code","window","showInformationMessage","showErrorMessage","subscriptions","push","exports","deactivate","module"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;;;AAEAA,eAAMC,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CACE,UAAUC,MAAV,EAAkB;AAChB,MAAIA,MAAM,CAACC,MAAP,KAAkB,MAAtB,EAA8B;AAC5BD,IAAAA,MAAM,CAACE,IAAP,GAAcC,YAAGC,SAAH,CAAaJ,MAAM,CAACE,IAApB,CAAd;AACD;;AACD,SAAOF,MAAP;AACD,CANH,EAOE,UAAUK,KAAV,EAAiB;AACf,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CATH;;AAYAT,eAAMC,YAAN,CAAmBW,QAAnB,CAA4BT,GAA5B,CACE,UAAUS,QAAV,EAAoB;AAClB;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBF,QAAQ,CAACG,MAAjC;AACA,SAAOH,QAAQ,CAACN,IAAhB;AACD,CALH,EAME,UAAUG,KAAV,EAAiB;AACf;AACA;AACA,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACD,CAVH;;eAaeT;;;;;;;;;;AC5Bf;;AAKA;;;;;;;;AAHA,MAAMgB,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;AACA,MAAMC,CAAC,GAAGD,OAAO,CAAC,SAAD,CAAjB;;AACA,MAAME,IAAI,GAAGF,OAAO,CAAC,SAAD,CAApB;;AAGA,MAAMG,EAAE,GAAG,oCAAX;;AAEA,SAASC,cAAT,CAAwBC,OAAxB,EAAiC;AAC/B,QAAMC,CAAC,GAAGH,EAAE,CAACI,IAAH,CAAQF,OAAR,EAAiB,CAAjB,CAAV;AACA,MAAIG,GAAG,GAAGN,IAAI,CAACO,QAAL,CAAcH,CAAd,KAAoB,EAA9B;AACA,SAAOE,GAAP;AACD;;AAED,SAASE,cAAT,CAAwBC,EAAxB,EAA4BN,OAA5B,EAAqC;AACnCT,EAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA8Bc,EAA9B,EAAkCT,IAAI,CAACU,IAAL,CAAUD,EAAV,CAAlC;AACA,QAAML,CAAC,GAAGJ,IAAI,CAACU,IAAL,CAAUD,EAAV,IAAgB,IAAhB,GAAuBN,OAAO,CAACQ,OAAR,CAAgBV,EAAhB,EAAoB,EAApB,CAAjC,CAFmC,CAGnC;;AACA,SAAOG,CAAP;AACD,EACD;;;AACA,MAAMQ,MAAM,GAAGC,MAAM,CAACC,SAAP,CAAiBC,gBAAjB,GAAoCC,GAApC,CAAwC,qBAAxC,CAAf,EAEA;;AACA,MAAMC,QAAQ,GAAGJ,MAAM,CAACC,SAAP,CACdC,gBADc,GAEdC,GAFc,CAEV,uBAFU,CAAjB;AAIA,MAAME,OAAO,GAAG;AACdC,EAAAA,MAAM,EACJ,8HAFY;AAGd,qBAAmB,yBAHL;AAId,oBAAkB,UAJJ;AAKd,oBAAkB,UALJ;AAMd,oBAAkB,aANJ;AAOd,oBAAkB,IAPJ;AAQd,+BAA6B,GARf;AASdP,EAAAA,MATc;AAUdQ,EAAAA,QAAQ,EAAEH;AAVI,CAAhB,EAaA;;AACA,eAAeI,OAAf,CAAuBC,IAAvB,EAA6B;AAC3B5B,EAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmB2B,IAAnB;AACA,MAAIC,IAAI,GAAG,MAAMC,OAAO,EAAxB;AACA9B,EAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoB4B,IAApB;AACA,QAAME,GAAG,GAAI,GAAER,QAAS,YAAxB;AACA,QAAMS,OAAO,GAAG7B,EAAE,CAAC8B,YAAH,CAAgBL,IAAhB,EAAsB,MAAtB,CAAhB;AACA,MAAIM,WAAW,GAAG1B,cAAc,CAACwB,OAAD,CAAhC,CAN2B,CAO3B;;AACA,MAAIG,WAAW,GAAGD,WAAW,CAACE,GAAZ,CAAgB,CAAhB,CAAlB;AACA,MAAIC,OAAO,GACTF,WAAW,IAAIN,IAAI,CAACQ,OAApB,GACIR,IAAI,CAACQ,OAAL,CAAaF,WAAb,CADJ,GAEI,MAAMG,UAAU,CAACH,WAAD,EAAcN,IAAd,CAHtB;AAKA,QAAMpC,IAAI,GAAG;AACX8C,IAAAA,KAAK,EAAE,EADI;AAEXC,IAAAA,EAAE,EAAE,EAFO;AAGXC,IAAAA,SAAS,EAAEZ,IAAI,CAACa,QAHL;AAIXC,IAAAA,KAAK,EAAET,WAAW,CAACS,KAJR;AAKXlC,IAAAA,OAAO,EAAEuB,OAAO,CAACf,OAAR,CAAgBV,EAAhB,EAAoB,EAApB,CALE;AAMXqC,IAAAA,YAAY,EAAE,CANH;AAOXP,IAAAA,OAAO,EAAEA,OAPE;AASX;AACAQ,IAAAA,cAAc,EAAE,QAVL;AAWXC,IAAAA,IAAI,EAAE,CAXK;AAYXC,IAAAA,UAAU,EAAE,EAZD;AAaXC,IAAAA,OAAO,EAAE,CAbE;AAcXC,IAAAA,YAAY,EAAE,CAdH;AAeXC,IAAAA,MAAM,EAAE,CAfG;AAgBXC,IAAAA,WAAW,EAAE,CAhBF;AAiBXC,IAAAA,WAAW,EAAE;AAjBF,GAAb;AAoBA,MAAIC,IAAI,GAAG,MAAMlE,eAAMmE,IAAN,CAAWvB,GAAX,EAAgBtC,IAAhB,EAAsB;AAAE+B,IAAAA;AAAF,GAAtB,CAAjB;AACC;;;;;;;;;;;;;CAAD;AAeAxB,EAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBoD,IAApB;AAEA,MAAIb,EAAE,GAAGa,IAAI,CAACE,MAAL,CAAYf,EAArB;AAEA,MAAIgB,OAAO,GAAI,GAAEjC,QAAS,UAASiB,EAAG,EAAtC;AACAxC,EAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuBuD,OAAvB,EAvD2B,CAwD3B;;AACAtB,EAAAA,WAAW,CAAC,eAAD,CAAX,GAA+B;AAC7BuB,IAAAA,OAAO,EAAED;AADoB,GAA/B;AAIA,MAAI9C,CAAC,GAAGI,cAAc,CAACoB,WAAD,EAAcF,OAAd,CAAtB;AACA7B,EAAAA,EAAE,CAACuD,aAAH,CAAiB9B,IAAjB,EAAuBlB,CAAvB,EAA0B,MAA1B,EA9D2B,CA+D3B;AAEA;AACA;AACA;AACA;;AACA,SAAO2C,IAAP;AACD,EAED;;;AACA,eAAevB,OAAf,GAAyB;AACvB,QAAMC,GAAG,GAAI,GAAER,QAAS,aAAxB;AACAvB,EAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuB8B,GAAvB;AACA,MAAI4B,IAAI,GAAG,MAAMxE,eAAMmC,GAAN,CAAUS,GAAV,EAAe;AAAEP,IAAAA;AAAF,GAAf,CAAjB,CAHuB,CAIvB;AACA;;AACA,MAAIoC,GAAG,GAAGvD,CAAC,CAACwD,IAAF,CAAOF,IAAI,IAAI,EAAf,CAAV;AACA,MAAIG,iBAAiB,GAAGF,GAAG,CAAC,sCAAD,CAA3B;AACA,MAAIf,cAAc,GAAGiB,iBAAiB,CAACC,OAAlB,GAA4BC,MAA5B,CAAmC,CAACC,GAAD,EAAMC,GAAN,KAAc;AACpED,IAAAA,GAAG,CAAC5D,CAAC,CAAC6D,GAAD,CAAD,CAAOC,IAAP,EAAD,CAAH,GAAqBD,GAAG,CAACE,OAAJ,CAAYC,KAAjC;AACA,WAAOJ,GAAP;AACD,GAHoB,EAGlB,EAHkB,CAArB;AAKA,MAAIK,UAAU,GAAGV,GAAG,CAAC,+BAAD,CAApB;AACA,MAAIvB,OAAO,GAAGiC,UAAU,CAACP,OAAX,GAAqBC,MAArB,CAA4B,CAACC,GAAD,EAAMC,GAAN,KAAc;AACtDD,IAAAA,GAAG,CAAC5D,CAAC,CAAC6D,GAAD,CAAD,CAAOC,IAAP,EAAD,CAAH,GAAqBD,GAAG,CAACE,OAAJ,CAAYC,KAAjC;AACA,WAAOJ,GAAP;AACD,GAHa,EAGX,EAHW,CAAd;AAIA,MAAIM,WAAW,GAAGX,GAAG,CAAC,uBAAD,CAArB;AACA,MAAIlB,QAAQ,GAAG6B,WAAW,CAAC,CAAD,CAAX,CAAeH,OAAf,CAAuBC,KAAtC;AAEA,MAAIG,aAAa,GAAGZ,GAAG,CAAC,0BAAD,CAAvB;AACA,MAAIa,UAAU,GAAGD,aAAa,CAAC,CAAD,CAAb,CAAiBJ,OAAjB,CAAyB,YAAzB,CAAjB;AAEA,SAAO;AACLvB,IAAAA,cADK;AAELR,IAAAA,OAFK;AAGLK,IAAAA,QAHK;AAIL+B,IAAAA;AAJK,GAAP;AAMD,EAED;;;AACA,eAAenC,UAAf,CAA0BoC,IAA1B,EAAgC7C,IAAhC,EAAsC;AACpC,QAAME,GAAG,GAAI,GAAER,QAAS,8BAAxB;AACA,QAAM9B,IAAI,GAAG;AACXkF,IAAAA,KAAK,EAAE9C,IAAI,CAAC4C,UADD;AAEX/B,IAAAA,QAAQ,EAAEb,IAAI,CAACa,QAFJ;AAGXD,IAAAA,SAAS,EAAEZ,IAAI,CAACa,QAHL;AAIXgC,IAAAA;AAJW,GAAb;AAMA,MAAIrB,IAAI,GAAG,MAAMlE,eAAMmE,IAAN,CAAWvB,GAAX,EAAgBtC,IAAhB,EAAsB;AAAE+B,IAAAA;AAAF,GAAtB,CAAjB,CARoC,CASpC;;AACA,SAAO6B,IAAI,CAACE,MAAL,CAAYf,EAAnB;AACD;;eAEcb;;;;;;;;;;AClKf;;;;AAEA,eAAeiD,UAAf,CAA0BhD,IAA1B,EAAgC;AAC9B5B,EAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0B2B,IAA1B;AACA,SAAO,sBAAQA,IAAR,CAAP;AACD;;eAEcgD;;;;;ACJf;;AAEA;;;;;;;;AALA;AACA;AACA;AAIA;AACA;;AAEA;;;AAGA,SAASC,QAAT,CAAkBC,OAAlB,EAA2B;AACzB;AACA;AACA9E,EAAAA,OAAO,CAACC,GAAR,CAAY,+DAAZ,EAHyB,CAKzB;AACA;AACA;;AACA,MAAI8E,UAAU,GAAG5D,MAAM,CAAC6D,QAAP,CAAgBC,eAAhB,CACf,sBADe,EAEf,gBAAgB;AAAEC,IAAAA;AAAF,GAAhB,EAA4B;AAC1B,QAAI;AAAEC,MAAAA;AAAF,QAAW,MAAM,uBAAWD,MAAX,CAArB,CAD0B,CAE1B;;AACA,QAAIC,IAAI,KAAK,CAAb,EAAgB;AACdhE,MAAAA,MAAM,CAACiE,MAAP,CAAcC,sBAAd,CAAqC,MAArC;AACD,KAFD,MAEO;AACLlE,MAAAA,MAAM,CAACiE,MAAP,CAAcE,gBAAd,CAA+B,MAA/B;AACD;AACF,GAVc,CAAjB;AAaAR,EAAAA,OAAO,CAACS,aAAR,CAAsBC,IAAtB,CAA2BT,UAA3B;AACD;;AACDU,OAAO,CAACZ,QAAR,GAAmBA,QAAnB,EAEA;;AACA,SAASa,UAAT,GAAsB,CAAE;;AAExBC,MAAM,CAACF,OAAP,GAAiB;AACfZ,EAAAA,QADe;AAEfa,EAAAA;AAFe,CAAjB","file":"extension.js","sourceRoot":"..\\src","sourcesContent":["import axios from \"axios\";\r\nimport qs from \"qs\";\r\n\r\naxios.interceptors.request.use(\r\n  function (config) {\r\n    if (config.method === \"post\") {\r\n      config.data = qs.stringify(config.data);\r\n    }\r\n    return config;\r\n  },\r\n  function (error) {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\naxios.interceptors.response.use(\r\n  function (response) {\r\n    // 对响应数据做点什么\r\n    console.log(\"response\", response.status);\r\n    return response.data;\r\n  },\r\n  function (error) {\r\n    // 对响应错误做点什么\r\n    // console.log(\"error\");\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default axios;\r\n","import axios from \"../../axios\";\r\n\r\nconst fs = require(\"fs\");\r\nconst $ = require(\"cheerio\");\r\nconst yaml = require(\"js-yaml\");\r\nimport * as vscode from \"vscode\";\r\n\r\nconst re = /---(.*?)---/s;\r\n\r\nfunction getFrontMatter(content) {\r\n  const s = re.exec(content)[1];\r\n  let obj = yaml.safeLoad(s) || {};\r\n  return obj;\r\n}\r\n\r\nfunction setFrontMatter(fm, content) {\r\n  console.log(\"setFrontMatter\", fm, yaml.dump(fm));\r\n  const s = yaml.dump(fm) + \"\\n\" + content.replace(re, \"\");\r\n  // fs.writeFileSync(path, s, \"utf8\");\r\n  return s;\r\n}\r\n// cookie 信息\r\nconst cookie = vscode.workspace.getConfiguration().get(\"publish-blog.cookie\");\r\n\r\n// 个人主页\r\nconst mainPage = vscode.workspace\r\n  .getConfiguration()\r\n  .get(\"publish-blog.mainPage\");\r\n\r\nconst headers = {\r\n  accept:\r\n    \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\",\r\n  \"accept-language\": \"zh-CN,zh;q=0.9,en;q=0.8\",\r\n  \"sec-fetch-dest\": \"document\",\r\n  \"sec-fetch-mode\": \"navigate\",\r\n  \"sec-fetch-site\": \"same-origin\",\r\n  \"sec-fetch-user\": \"?1\",\r\n  \"upgrade-insecure-requests\": \"1\",\r\n  cookie,\r\n  referrer: mainPage,\r\n};\r\n\r\n// 将path路径中的md文件发布到osc\r\nasync function publish(path) {\r\n  console.log(\"osc\", path);\r\n  let info = await getInfo();\r\n  console.log(\"info\", info);\r\n  const url = `${mainPage}/blog/save`;\r\n  const CONTENT = fs.readFileSync(path, \"utf8\");\r\n  let frontMatter = getFrontMatter(CONTENT);\r\n  // 默认将第一个tag作为分类\r\n  let catalogName = frontMatter.tag[0];\r\n  let catalog =\r\n    catalogName in info.catalog\r\n      ? info.catalog[catalogName]\r\n      : await addCatalog(catalogName, info);\r\n\r\n  const data = {\r\n    draft: \"\",\r\n    id: \"\",\r\n    user_code: info.userCode,\r\n    title: frontMatter.title,\r\n    content: CONTENT.replace(re, \"\"),\r\n    content_type: 3,\r\n    catalog: catalog,\r\n\r\n    // 默认全部发送到编程语言, 或者第一个分类, 或者可以在front matter 中自定义\r\n    classification: \"428609\",\r\n    type: 1,\r\n    origin_url: \"\",\r\n    privacy: 0,\r\n    deny_comment: 0,\r\n    as_top: 0,\r\n    downloadImg: 0,\r\n    isRecommend: 0,\r\n  };\r\n\r\n  let resp = await axios.post(url, data, { headers });\r\n  `\r\ncode:1\r\nmessage:\"发表成功\"\r\ntime:\"2020-06-30 17:57:14\"\r\nresult:{\r\nid\r\ncatalog:7028036\r\nclassification:428609\r\ncontent:\"\r\nas_top:0\r\nabstracts:\"Front Matter in VuePress Any markdown fi\r\nid:4330304\r\n}\r\n`;\r\n\r\n  console.log(\"resp\", resp);\r\n\r\n  let id = resp.result.id;\r\n\r\n  let blogUrl = `${mainPage}//blog/${id}`;\r\n  console.log(\"blogUrl\", blogUrl);\r\n  // 写入 fm\r\n  frontMatter[\"_publish_blog\"] = {\r\n    oschina: blogUrl,\r\n  };\r\n\r\n  let s = setFrontMatter(frontMatter, CONTENT);\r\n  fs.writeFileSync(path, s, \"utf8\");\r\n  //   console.log(resp.data);\r\n\r\n  // {\r\n  //   code: 1,\r\n  //   message: '发表成功'\r\n  // }\r\n  return resp;\r\n}\r\n\r\n// 获取发布时的信息, 分类, user_code, 类别等\r\nasync function getInfo() {\r\n  const url = `${mainPage}/blog/write`;\r\n  console.log(\"getInfo\", url);\r\n  let html = await axios.get(url, { headers });\r\n  // console.log(\"html\", html);\r\n  // catalog classification\r\n  let dom = $.load(html || \"\");\r\n  let classificationDom = dom('select[name=\"classification\"]>option');\r\n  let classification = classificationDom.toArray().reduce((pre, now) => {\r\n    pre[$(now).text()] = now.attribs.value;\r\n    return pre;\r\n  }, {});\r\n\r\n  let catalogDom = dom('select[name=\"catalog\"]>option');\r\n  let catalog = catalogDom.toArray().reduce((pre, now) => {\r\n    pre[$(now).text()] = now.attribs.value;\r\n    return pre;\r\n  }, {});\r\n  let userCodeDom = dom(\"input[name=user_code]\");\r\n  let userCode = userCodeDom[0].attribs.value;\r\n\r\n  let dataUserIdDom = dom('val[data-name=\"spaceId\"]');\r\n  let dataUserId = dataUserIdDom[0].attribs[\"data-value\"];\r\n\r\n  return {\r\n    classification,\r\n    catalog,\r\n    userCode,\r\n    dataUserId,\r\n  };\r\n}\r\n\r\n// 添加新的分类, 返回新增加的分类id\r\nasync function addCatalog(name, info) {\r\n  const url = `${mainPage}/blog/quick_add_blog_catalog`;\r\n  const data = {\r\n    space: info.dataUserId,\r\n    userCode: info.userCode,\r\n    user_code: info.userCode,\r\n    name,\r\n  };\r\n  let resp = await axios.post(url, data, { headers });\r\n  // 新增加的分类的id号\r\n  return resp.result.id;\r\n}\r\n\r\nexport default publish;\r\n","import oschina from \"./oschina\";\r\n\r\nasync function publishAll(path) {\r\n  console.log(\"publishAll\", path);\r\n  return oschina(path);\r\n}\r\n\r\nexport default publishAll;\r\n","// The module 'vscode' contains the VS Code extensibility API\n// Import the module and reference it with the alias vscode in your code below\n// const vscode = require(\"vscode\");\nimport * as vscode from \"vscode\";\n\nimport publishAll from \"./platform\";\n// this method is called when your extension is activated\n// your extension is activated the very first time the command is executed\n\n/**\n * @param {vscode.ExtensionContext} context\n */\nfunction activate(context) {\n  // Use the console to output diagnostic information (console.log) and errors (console.error)\n  // This line of code will only be executed once when your extension is activated\n  console.log('Congratulations, your extension \"publish-blog\" is now active!');\n\n  // The command has been defined in the package.json file\n  // Now provide the implementation of the command with  registerCommand\n  // The commandId parameter must match the command field in package.json\n  let disposable = vscode.commands.registerCommand(\n    \"publish-blog.publish\",\n    async function ({ fsPath }) {\n      let { code } = await publishAll(fsPath);\n      // The code you place here will be executed every time your command is executed\n      if (code === 1) {\n        vscode.window.showInformationMessage(\"发布成功\");\n      } else {\n        vscode.window.showErrorMessage(\"发布失败\");\n      }\n    }\n  );\n\n  context.subscriptions.push(disposable);\n}\nexports.activate = activate;\n\n// this method is called when your extension is deactivated\nfunction deactivate() {}\n\nmodule.exports = {\n  activate,\n  deactivate,\n};\n"]}